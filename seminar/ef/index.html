
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Dudás Ákos">
      
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.6">
    
    
      
        <title>Entity Framework - BMEVIAUAC01 Data-driven systems</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.802231af.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../extra-material-theme.css">
    
    
      


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="red" data-md-color-accent="red">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#entity-framework" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="BMEVIAUAC01 Data-driven systems" class="md-header__button md-logo" aria-label="BMEVIAUAC01 Data-driven systems" data-md-component="logo">
      
  <img src="../../img/logo-bme-aut.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BMEVIAUAC01 Data-driven systems
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Entity Framework
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Switch to dark theme"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark theme" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent=""  aria-label="Switch to light theme"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light theme" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/bmeviauac01/datadriven-en/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    bmeviauac01/datadriven-en
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Data-driven systems
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../db/" class="md-tabs__link">
        Database
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../lecture-notes/architecture/" class="md-tabs__link">
        Lecture notes
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../transactions/" class="md-tabs__link md-tabs__link--active">
        Seminars
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../homework/" class="md-tabs__link">
        Homework
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="BMEVIAUAC01 Data-driven systems" class="md-nav__button md-logo" aria-label="BMEVIAUAC01 Data-driven systems" data-md-component="logo">
      
  <img src="../../img/logo-bme-aut.png" alt="logo">

    </a>
    BMEVIAUAC01 Data-driven systems
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/bmeviauac01/datadriven-en/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    bmeviauac01/datadriven-en
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Data-driven systems
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Database
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Database" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Database
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../db/" class="md-nav__link">
        Sample database scheme
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../db/mssql/" class="md-nav__link">
        Using Microsoft SQL Server
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../db/mongodb/" class="md-nav__link">
        Using MongoDB
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="https://raw.githubusercontent.com/bmeviauac01/adatvezerelt/master/docs/db/mssql.sql" class="md-nav__link">
        Sample database: mssql.sql
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="https://raw.githubusercontent.com/bmeviauac01/adatvezerelt/master/docs/db/mongo.js" class="md-nav__link">
        Sample database: mongo.js
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Lecture notes
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Lecture notes" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Lecture notes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lecture-notes/architecture/" class="md-nav__link">
        Data-driven systems and the thee- or multi-tier architecture
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lecture-notes/transactions/" class="md-nav__link">
        Transactions in databases
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lecture-notes/mssql/sql/" class="md-nav__link">
        SQL language, MSSQL platform-specific SQL
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lecture-notes/mssql/server-side-programming/" class="md-nav__link">
        Microsoft SQL Server programming
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lecture-notes/linq/" class="md-nav__link">
        LINQ: Language Integrated Query
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lecture-notes/mongodb/" class="md-nav__link">
        MongoDB basics, operations, and the MongoDB .NET Driver
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lecture-notes/di/" class="md-nav__link">
        Dependency Injection ASP.NET Core environment
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../lecture-notes/async/" class="md-nav__link">
        Asynchronous queries and DTOs (sample WebAPI application)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/bmeviauac01/rest-webapi-sample" class="md-nav__link">
        REST and WebAPI sample app (GitHub)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/bmeviauac01/todoapi-di-sample" class="md-nav__link">
        ASP.NET Core DI sample app (GitHub)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/bmeviauac01/threelayered-aspnetcore-sample" class="md-nav__link">
        Sample three-tier webapp (GitHub)
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      <label class="md-nav__link" for="__nav_4">
        Seminars
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Seminars" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Seminars
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../transactions/" class="md-nav__link">
        Transactions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../mssql/" class="md-nav__link">
        Microsoft SQL Server programming
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Entity Framework
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Entity Framework
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-work-during-the-seminar" class="md-nav__link">
    How to work during the seminar
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-0-createcheck-the-database" class="md-nav__link">
    Exercise 0: Create/check the database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-1-create-a-project-and-map-the-database" class="md-nav__link">
    Exercise 1: Create a project and map the database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-2-queries" class="md-nav__link">
    Exercise 2: Queries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-3-data-modification" class="md-nav__link">
    Exercise 3: Data modification
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-4-using-stored-procedures" class="md-nav__link">
    Exercise 4: Using stored procedures
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../mongodb/" class="md-nav__link">
        MongoDB
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../jpa/" class="md-nav__link">
        JPA & Spring Data
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../rest/" class="md-nav__link">
        REST API & ASP.NET Web API
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        Homework
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Homework" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Homework
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/" class="md-nav__link">
        Optional homework
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/mssql/" class="md-nav__link">
        Exercise: MSSQL server-side programming
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/adonet/" class="md-nav__link">
        Exercise: ADO.NET data access
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/ef/" class="md-nav__link">
        Exercise: Entity Framework
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/mongodb/" class="md-nav__link">
        Exercise: MongoDB
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/rest/" class="md-nav__link">
        Exercise: REST API and Web API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/GitHub/" class="md-nav__link">
        Submitting your work (GitHub)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/GitHub-Actions/" class="md-nav__link">
        Using GitHub Actions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../homework/VisualStudio/" class="md-nav__link">
        Install Visual Studio & .NET Core SDK
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-work-during-the-seminar" class="md-nav__link">
    How to work during the seminar
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-0-createcheck-the-database" class="md-nav__link">
    Exercise 0: Create/check the database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-1-create-a-project-and-map-the-database" class="md-nav__link">
    Exercise 1: Create a project and map the database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-2-queries" class="md-nav__link">
    Exercise 2: Queries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-3-data-modification" class="md-nav__link">
    Exercise 3: Data modification
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-4-using-stored-procedures" class="md-nav__link">
    Exercise 4: Using stored procedures
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/bmeviauac01/datadriven-en/edit/master/docs/seminar/ef/index.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="entity-framework">Entity Framework<a class="headerlink" href="#entity-framework" title="Permanent link">&para;</a></h1>
<p>The goal of the seminar is to practice writing Linq queries and working with Entity Framework.</p>
<div class="admonition important">
<p class="admonition-title">Entity Framework <del>Core</del></p>
<p>In this seminar, we are using Entity Framework available in the .NET Framework and not the cross-platform Core version. The usage of Linq is very similar, if not identical in both technologies. The visual code generation technology, however, is only available in the .NET Framework and Entity Framework.</p>
</div>
<h2 id="pre-requisites">Pre-requisites<a class="headerlink" href="#pre-requisites" title="Permanent link">&para;</a></h2>
<p>Required tools to complete the tasks:</p>
<ul>
<li>Microsoft Visual Studio 2015/2017/2019 (<em>not</em> VS Code)</li>
<li>Microsoft SQL Server (LocalDB or Express edition)</li>
<li>SQL Server Management Studio</li>
<li>Database initialization script: <a href="https://raw.githubusercontent.com/bmeviauac01/adatvezerelt/master/docs/db/mssql.sql">mssql.sql</a></li>
</ul>
<p>Recommended to review:</p>
<ul>
<li>C# language</li>
<li>Entity Framework and Linq</li>
</ul>
<h2 id="how-to-work-during-the-seminar">How to work during the seminar<a class="headerlink" href="#how-to-work-during-the-seminar" title="Permanent link">&para;</a></h2>
<p>The exercises are solved together with the instructor. A few exercises we can try to solve by ourselves and then discuss the results. The final exercise is individual work if time permits.</p>
<div class="admonition info">
<p>This guide summarizes and explains the behavior. Before looking at these provided answers, we should think first!</p>
</div>
<h2 id="exercise-0-createcheck-the-database">Exercise 0: Create/check the database<a class="headerlink" href="#exercise-0-createcheck-the-database" title="Permanent link">&para;</a></h2>
<p>The database resides on each machine; thus, the database you created previously might not be available. First, check if your database exists, and if it does not, create and initialize it. (See the instructions <a href="../transactions/">in the first seminar material</a>.)</p>
<h2 id="exercise-1-create-a-project-and-map-the-database">Exercise 1: Create a project and map the database<a class="headerlink" href="#exercise-1-create-a-project-and-map-the-database" title="Permanent link">&para;</a></h2>
<p>Let us create a new C# console application in Visual Studio. In VS 2019 search for "console framework"; this will yield the project template we are looking for.</p>
<p><img alt="VS projext type" src="images/vs-create-project.png" /></p>
<div class="admonition important">
<p>Do <strong>not</strong> create a .NET <em>Core</em> application because it does not support the visual <em>Database First</em> code generation we will use.</p>
<p>Mind the project language: it shall be C#.</p>
</div>
<p>Create a new project; you may work in directory <code>c:\work</code>.</p>
<ol>
<li>
<p>Add a new <em>ADO.NET Entity Data Model</em> to the project.</p>
<ul>
<li>In Solution Explorer right-click the project / <em>Add / New Item / Data / ADO.NET Entity Data Model</em>. At the bottom of the dialog, use the name <code>DataDrivenEntities</code>.</li>
<li>The model shall be created based on an existing database: in the wizard, choose the "EF designer from database" option.</li>
<li>Specify the connection to the database. Create a new connection and save the connection string into the app config file.<ul>
<li><em>Data source</em>: Microsoft SQL Server</li>
<li><em>Server name</em>: <code>(localdb)\mssqllocaldb</code></li>
<li><em>Select or enter database name</em>: let us chose our database</li>
<li><em>Save connection settings in App.Config</em>:<ul>
<li>yes (check)</li>
<li>use the name <code>DataDrivenEntities</code> (this will be the name of the DbContext class)</li>
</ul>
</li>
</ul>
</li>
<li>Use Entity Framework 6.0 mapping.</li>
<li>Map all tables: make a check next to the <em>Tables</em> folder.</li>
<li><em>Model namespace</em>: e.g. <code>DataDrivenEntitiesModel</code></li>
</ul>
</li>
<li>
<p>Wait for the code generation. If VS asks about running a "template" let us allow it.</p>
</li>
<li>
<p>Locate the <em>connection string</em> in <code>app.config</code> and check its contents.</p>
<div class="admonition note">
<p class="admonition-title"><code>app.config</code></p>
<p>It is advisable to put configuration, such as the <em>connection string</em> here, because the database access information may be different for each installation of an application. If the connection string is hard-wired into the source code, the application needs to be recompiled to change it. However, the <code>app.config</code> file is part of the application next to the executable is an editable xml format.</p>
</div>
</li>
<li>
<p>Open the EF data model (double-click in the Solution Explorer). Let us examine the entities and the connections.</p>
<ul>
<li>The model can be changed using the <em>Entity Data Model Browser</em> and <em>Entity Data Model Mapping Details</em> windows (if not visible open them through <em>View</em> / <em>Other windows</em>).</li>
<li>
<p>Let us make a few corrections in the generated names:</p>
<ul>
<li>Customer.CustomerSite1 -&gt; <strong>.Sites</strong></li>
<li>CustomerSite.Customer1 -&gt; <strong>.MainCustomer</strong></li>
<li>Order.OrderItem -&gt; .OrderItem&#8203;<strong>s</strong></li>
<li>Product.OrderItem -&gt; .OrderItem&#8203;<strong>s</strong></li>
<li>VAT.Product -&gt; .Product&#8203;<strong>s</strong></li>
<li>Category.Product -&gt; .Product&#8203;<strong>s</strong></li>
</ul>
</li>
</ul>
<p>Save the model using Ctrl-S.</p>
</li>
<li>
<p>Let us examine the C# source code of the <em>DbContext</em> any one of the entity classes. In <em>Solution Explorer</em> expand the EDM model file, and the C# source files will be listed underneath.</p>
<div class="admonition note">
<p>You should <em>not</em> make changes to these files, as these are generated by the EDM model. Any change we make is lost when the EDM is re-generated. We may note, however, that all classes are declared as <code>partial</code>; thus we can extend them by creating new source files and using the same namespace and class name.</p>
</div>
</li>
</ol>
<h2 id="exercise-2-queries">Exercise 2: Queries<a class="headerlink" href="#exercise-2-queries" title="Permanent link">&para;</a></h2>
<p>In the following exercises, write C# code using Linq to Entities. The results should be printed to console.</p>
<p>You can check the SQL query generated in runtime: hover over the IQueryable variable once the iteration of the list is underway; it will show you the generated command.</p>
<ol>
<li>
<p>List the names and the amount of stock of all products that we have more than 30 in stock!</p>
</li>
<li>
<p>List the products that have been ordered at least twice!</p>
</li>
<li>
<p>List the orders that have a total value of at least 30.000! For each order, print the customer name and list all items of the order (with the product name, amount, and price).</p>
</li>
<li>
<p>Find the most expensive product!</p>
</li>
<li>
<p>List all customer record pairs that have their main site of business in the same city. Each pair should only be listed once.</p>
</li>
</ol>
<details class="example"><summary>Solution</summary><div class="highlight"><pre><span></span><code><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;***** Exercise two *****&quot;</span><span class="p">);</span>
<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">db</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DataDrivenEntities</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">// 2.1</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t2.1:&quot;</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">qProductStock</span> <span class="p">=</span> <span class="k">from</span> <span class="n">p</span> <span class="k">in</span> <span class="n">db</span><span class="p">.</span><span class="n">Product</span>
                        <span class="k">where</span> <span class="n">p</span><span class="p">.</span><span class="n">Stock</span> <span class="p">&gt;</span> <span class="m">30</span>
                        <span class="k">select</span> <span class="n">p</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">p</span> <span class="k">in</span> <span class="n">qProductStock</span><span class="p">)</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t\tName={0}\tStock={1}&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Stock</span><span class="p">);</span>

    <span class="c1">// 2.2</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t2.2:&quot;</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">qProductOrder</span> <span class="p">=</span> <span class="k">from</span> <span class="n">p</span> <span class="k">in</span> <span class="n">db</span><span class="p">.</span><span class="n">Product</span>
                        <span class="k">where</span> <span class="n">p</span><span class="p">.</span><span class="n">OrderItems</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;=</span> <span class="m">2</span>
                        <span class="k">select</span> <span class="n">p</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">p</span> <span class="k">in</span> <span class="n">qProductOrder</span><span class="p">)</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t\tName={0}&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>

    <span class="c1">// 2.3</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t2.3:&quot;</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">qOrderTotal</span> <span class="p">=</span> <span class="k">from</span> <span class="n">o</span> <span class="k">in</span> <span class="n">db</span><span class="p">.</span><span class="n">Order</span>
                        <span class="k">where</span> <span class="n">o</span><span class="p">.</span><span class="n">OrderItems</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">oi</span> <span class="p">=&gt;</span> <span class="n">oi</span><span class="p">.</span><span class="n">Amount</span> <span class="p">*</span> <span class="n">oi</span><span class="p">.</span><span class="n">Price</span><span class="p">)</span> <span class="p">&gt;</span> <span class="m">30000</span>
                        <span class="k">select</span> <span class="n">o</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">o</span> <span class="k">in</span> <span class="n">qOrderTotal</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t\tName={0}&quot;</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">CustomerSite</span><span class="p">.</span><span class="n">MainCustomer</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">oi</span> <span class="k">in</span> <span class="n">o</span><span class="p">.</span><span class="n">OrderItems</span><span class="p">)</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t\t\tProduct={0}\tPrice={1}\tAmount={2}&quot;</span><span class="p">,</span> <span class="n">oi</span><span class="p">.</span><span class="n">Product</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">oi</span><span class="p">.</span><span class="n">Price</span><span class="p">,</span> <span class="n">oi</span><span class="p">.</span><span class="n">Amount</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// 2.3 alternative solution</span>
    <span class="c1">// A new namespace import is needed; copy the following line to the top of this file!</span>
    <span class="c1">// using System.Data.Entity;</span>

    <span class="c1">// Generates a single query and populates the Navigation Properties too</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\tc 2.3 alternative solution:&quot;</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">qOrderTotal2</span> <span class="p">=</span>
        <span class="k">from</span> <span class="n">o</span> <span class="k">in</span> <span class="n">db</span><span class="p">.</span><span class="n">Order</span>
            <span class="p">.</span><span class="n">Include</span><span class="p">(</span><span class="n">o</span> <span class="p">=&gt;</span> <span class="n">o</span><span class="p">.</span><span class="n">OrderItems</span><span class="p">)</span>                          <span class="c1">// or .Include(&quot;OrderItem&quot;)</span>
            <span class="p">.</span><span class="n">Include</span><span class="p">(</span><span class="n">o</span> <span class="p">=&gt;</span> <span class="n">o</span><span class="p">.</span><span class="n">OrderItems</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">oi</span> <span class="p">=&gt;</span> <span class="n">oi</span><span class="p">.</span><span class="n">Product</span><span class="p">))</span> <span class="c1">// or .Include(&quot;OrderItem.Product&quot;)</span>
            <span class="p">.</span><span class="n">Include</span><span class="p">(</span><span class="n">o</span> <span class="p">=&gt;</span> <span class="n">o</span><span class="p">.</span><span class="n">CustomerSite</span><span class="p">)</span>                        <span class="c1">// or .Include(&quot;CustomerSite&quot;)</span>
            <span class="p">.</span><span class="n">Include</span><span class="p">(</span><span class="n">o</span> <span class="p">=&gt;</span> <span class="n">o</span><span class="p">.</span><span class="n">CustomerSite</span><span class="p">.</span><span class="n">MainCustomer</span><span class="p">)</span>           <span class="c1">// or .Include(&quot;CustomerSite.Customer&quot;)</span>
        <span class="k">where</span> <span class="n">o</span><span class="p">.</span><span class="n">OrderItems</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">oi</span> <span class="p">=&gt;</span> <span class="n">oi</span><span class="p">.</span><span class="n">Amount</span> <span class="p">*</span> <span class="n">oi</span><span class="p">.</span><span class="n">Price</span><span class="p">)</span> <span class="p">&gt;</span> <span class="m">30000</span>
        <span class="k">select</span> <span class="n">o</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">o</span> <span class="k">in</span> <span class="n">qOrderTotal2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t\tName={0}&quot;</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">CustomerSite</span><span class="p">.</span><span class="n">MainCustomer</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">oi</span> <span class="k">in</span> <span class="n">o</span><span class="p">.</span><span class="n">OrderItems</span><span class="p">)</span>
            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t\t\tProduct={0}\tPrice={1}\tAmount={2}&quot;</span><span class="p">,</span> <span class="n">oi</span><span class="p">.</span><span class="n">Product</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">oi</span><span class="p">.</span><span class="n">Price</span><span class="p">,</span> <span class="n">oi</span><span class="p">.</span><span class="n">Amount</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// 2.4</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t2.4:&quot;</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">qPriceMax</span> <span class="p">=</span> <span class="k">from</span> <span class="n">p</span> <span class="k">in</span> <span class="n">db</span><span class="p">.</span><span class="n">Product</span>
                    <span class="k">where</span> <span class="n">p</span><span class="p">.</span><span class="n">Price</span> <span class="p">==</span> <span class="n">db</span><span class="p">.</span><span class="n">Product</span><span class="p">.</span><span class="n">Max</span><span class="p">(</span><span class="n">a</span> <span class="p">=&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">Price</span><span class="p">)</span>
                    <span class="k">select</span> <span class="n">p</span><span class="p">;</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">t</span> <span class="k">in</span> <span class="n">qPriceMax</span><span class="p">)</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t\tName={0}\tPrice={1}&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">Price</span><span class="p">);</span>

    <span class="c1">// 2.5</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t2.5:&quot;</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">qJoin</span> <span class="p">=</span> <span class="k">from</span> <span class="n">s1</span> <span class="k">in</span> <span class="n">db</span><span class="p">.</span><span class="n">CustomerSite</span>
                <span class="k">join</span> <span class="n">s2</span> <span class="k">in</span> <span class="n">db</span><span class="p">.</span><span class="n">CustomerSite</span> <span class="k">on</span> <span class="n">s1</span><span class="p">.</span><span class="n">City</span> <span class="k">equals</span> <span class="n">s2</span><span class="p">.</span><span class="n">City</span>
                <span class="k">where</span> <span class="n">s1</span><span class="p">.</span><span class="n">CustomerID</span> <span class="p">&gt;</span> <span class="n">s2</span><span class="p">.</span><span class="n">CustomerID</span>
                <span class="k">select</span> <span class="k">new</span> <span class="p">{</span> <span class="n">c1</span> <span class="p">=</span> <span class="n">s1</span><span class="p">.</span><span class="n">MainCustomer</span><span class="p">,</span> <span class="n">c2</span> <span class="p">=</span> <span class="n">s2</span><span class="p">.</span><span class="n">MainCustomer</span> <span class="p">};</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">v</span> <span class="k">in</span> <span class="n">qJoin</span><span class="p">)</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t\tCustomer 1={0}\tCustomer 2={1}&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">c1</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">c2</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</details>
<h2 id="exercise-3-data-modification">Exercise 3: Data modification<a class="headerlink" href="#exercise-3-data-modification" title="Permanent link">&para;</a></h2>
<p>The DbContext can also be used to modify the database.</p>
<ol>
<li>
<p>Write C# code that increases the price of all products in category "LEGO" by 10 percent!</p>
</li>
<li>
<p>Create a new category named <em>Expensive toys</em> and move all products here that cost more than 8000!</p>
</li>
</ol>
<details class="example"><summary>Solution</summary><div class="highlight"><pre><span></span><code><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;***** Exercise three *****&quot;</span><span class="p">);</span>
<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">db</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DataDrivenEntities</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">// 3.1</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t3.1:&quot;</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">qProductsLego</span> <span class="p">=</span> <span class="k">from</span> <span class="n">p</span> <span class="k">in</span> <span class="n">db</span><span class="p">.</span><span class="n">Product</span>
                        <span class="k">where</span> <span class="n">p</span><span class="p">.</span><span class="n">Category</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">&quot;LEGO&quot;</span>
                        <span class="k">select</span> <span class="n">p</span><span class="p">;</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\tBefore change:&quot;</span><span class="p">);</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">p</span> <span class="k">in</span> <span class="n">qProductsLego</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t\t\tName={0}\tStock={1}\tPrice={2}&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Stock</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Price</span><span class="p">);</span>
        <span class="n">p</span><span class="p">.</span><span class="n">Price</span> <span class="p">=</span> <span class="m">1.1</span> <span class="p">*</span> <span class="n">p</span><span class="p">.</span><span class="n">Price</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">db</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>

    <span class="n">qProductsLego</span> <span class="p">=</span> <span class="k">from</span> <span class="n">p</span> <span class="k">in</span> <span class="n">db</span><span class="p">.</span><span class="n">Product</span>
                    <span class="k">where</span> <span class="n">p</span><span class="p">.</span><span class="n">Category</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">&quot;LEGO&quot;</span>
                    <span class="k">select</span> <span class="n">p</span><span class="p">;</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\tAfter change:&quot;</span><span class="p">);</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">p</span> <span class="k">in</span> <span class="n">qProductsLego</span><span class="p">)</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t\t\tName={0}\tStock={1}\tPrice={2}&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Stock</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Price</span><span class="p">);</span>

    <span class="c1">// 3.2</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t3.2:&quot;</span><span class="p">);</span>
    <span class="n">Category</span> <span class="n">categoryExpensiveToys</span> <span class="p">=</span> <span class="p">(</span><span class="k">from</span> <span class="n">c</span> <span class="k">in</span> <span class="n">db</span><span class="p">.</span><span class="n">Category</span>
                                        <span class="k">where</span> <span class="n">c</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">&quot;Expensive toys&quot;</span>
                                        <span class="k">select</span> <span class="n">c</span><span class="p">).</span><span class="n">SingleOrDefault</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">categoryExpensiveToys</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">categoryExpensiveToys</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Category</span> <span class="p">{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">&quot;Expensive toys&quot;</span> <span class="p">};</span>

        <span class="c1">// The following line is not always necessary. If there is any product assigned to this</span>
        <span class="c1">// new category, when saving the changes, a new category record will automatically be</span>
        <span class="c1">// created. If we add this explicitly though, it better reflects our way of thinking,</span>
        <span class="c1">// and if there are no assigned products, the new category record is created regardless.</span>
        <span class="n">db</span><span class="p">.</span><span class="n">Category</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">categoryExpensiveToys</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">var</span> <span class="n">qProductExpensive</span> <span class="p">=</span> <span class="k">from</span> <span class="n">p</span> <span class="k">in</span> <span class="n">db</span><span class="p">.</span><span class="n">Product</span>
                            <span class="k">where</span> <span class="n">p</span><span class="p">.</span><span class="n">Price</span> <span class="p">&gt;</span> <span class="m">8000</span>
                            <span class="k">select</span> <span class="n">p</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">p</span> <span class="k">in</span> <span class="n">qProductExpensive</span><span class="p">)</span>
        <span class="n">p</span><span class="p">.</span><span class="n">Category</span> <span class="p">=</span> <span class="n">categoryExpensiveToys</span><span class="p">;</span>
    <span class="n">db</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>

    <span class="n">qProductExpensive</span> <span class="p">=</span> <span class="k">from</span> <span class="n">p</span> <span class="k">in</span> <span class="n">db</span><span class="p">.</span><span class="n">Product</span>
                        <span class="k">where</span> <span class="n">p</span><span class="p">.</span><span class="n">Category</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">&quot;Expensive toys&quot;</span>
                        <span class="k">select</span> <span class="n">p</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">t</span> <span class="k">in</span> <span class="n">qProductExpensive</span><span class="p">)</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t\tName={0}\tPrice={1}&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">Price</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</details>
<h2 id="exercise-4-using-stored-procedures">Exercise 4: Using stored procedures<a class="headerlink" href="#exercise-4-using-stored-procedures" title="Permanent link">&para;</a></h2>
<p>Stored procedures can be mapped into the EDM model either as a method on the DbContext or an entity's operation.</p>
<div class="admonition note">
<p class="admonition-title">Procedure mapping in the EDM</p>
<p>The mapping properties of the stored procedure (e.g., the return value) usually has to be manually altered using the <em>Entity Data Model Browser</em>: find the <em>Function Import</em> and open its properties.</p>
<p><img alt="Mapping properties of a stored procedure" src="images/vs-storedproc-mapping.png" /></p>
</div>
<ol>
<li>
<p>Create a new stored procedure that can be used to register a new payment method. Map this stored procedure as the insert operation of the <code>PaymentMethod</code> entity!</p>
<ul>
<li>
<p>Create the stored procedure using SQL Management Studio.</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">CreateNewPaymentMethod</span>
<span class="p">(</span>
<span class="o">@</span><span class="k">Method</span> <span class="n">nvarchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<span class="o">@</span><span class="n">Deadline</span> <span class="nb">int</span>
<span class="p">)</span>
<span class="k">AS</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">PaymentMethod</span>
<span class="k">values</span><span class="p">(</span><span class="o">@</span><span class="k">Method</span><span class="p">,</span><span class="o">@</span><span class="n">Deadline</span><span class="p">)</span>
<span class="k">select</span> <span class="n">scope_identity</span><span class="p">()</span> <span class="k">as</span> <span class="n">NewId</span>
</code></pre></div>
</li>
<li>
<p>Set this procedure as the <code>PaymentMethod</code> entity <em>insert</em> operation.</p>
<ul>
<li>Add the stored procedure to the EDM. In the EDM Browser right-click to open the context menu and use "Update model from database" to <em>Add</em> the previously created procedure.</li>
<li>Save the model changes to generate the required C# code in the background.</li>
<li>
<p>Set this procedure on the <code>PaymentMethod</code> entity as the <em>insert</em> operation: select the <code>PaymentMethod</code> entity in the EDM and in the <em>Mapping Details</em> window change to the <em>Map Entity to Functions</em> tab, then chose the procedure for <em>Insert</em> operation. The return value shall be mapped to the <em>ID</em> property. Save the model.</p>
<p><img alt="Mapping procedure to entity" src="images/vs-insert-storedproc.png" /></p>
</li>
</ul>
</li>
<li>
<p>Test the behavior: in C# code, create a new <code>PaymentMethod</code> entity and add it to the appropriate list of the DbContext using <code>Add</code>. Verify the creation of the new record in the database.</p>
</li>
</ul>
</li>
<li>
<p>Create a stored procedure that lists all products that have been sold more than a specified amount of times. Call this method from C# code!</p>
<ul>
<li>
<p>Create the stored procedure with the T-SQL command below.</p>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">dbo</span><span class="p">.</span><span class="n">PopularProducts</span> <span class="p">(</span>
<span class="o">@</span><span class="n">MinAmount</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>
<span class="p">)</span>
<span class="k">AS</span>
<span class="k">SELECT</span> <span class="n">Product</span><span class="p">.</span><span class="o">*</span> <span class="k">FROM</span> <span class="n">Product</span> <span class="k">INNER</span> <span class="k">JOIN</span>
<span class="p">(</span>
<span class="k">SELECT</span> <span class="n">OrderItem</span><span class="p">.</span><span class="n">ProductID</span>
<span class="k">FROM</span> <span class="n">OrderItem</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">OrderItem</span><span class="p">.</span><span class="n">ProductID</span>
<span class="k">HAVING</span> <span class="k">SUM</span><span class="p">(</span><span class="n">OrderItem</span><span class="p">.</span><span class="n">Amount</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">@</span><span class="n">MinAmount</span>
<span class="p">)</span> <span class="n">a</span> <span class="k">ON</span> <span class="n">Product</span><span class="p">.</span><span class="n">ID</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="n">ProductID</span>
</code></pre></div>
</li>
<li>
<p>Import the procedure into the EDM. Open the function properties (in the <em>EDM Model Browser</em> double click <em>function</em>) and set return value as type <code>Product</code>. Save the model changes.</p>
<p><img alt="Map return value of a stored procedure" src="images/vs-storedproc-mapping.png" /></p>
</li>
<li>
<p>Use the new method available on the DbContext class to call this method and print the returned product names to console!</p>
</li>
</ul>
</li>
</ol>
<details class="example"><summary>Solution</summary><div class="highlight"><pre><span></span><code><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;***** Exercise four *****&quot;</span><span class="p">);</span>
<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">db</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DataDrivenEntities</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">// 4.3</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t4.3:&quot;</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">pm</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PaymentMethod</span>
    <span class="p">{</span>
        <span class="n">Method</span> <span class="p">=</span> <span class="s">&quot;Apple pay&quot;</span><span class="p">,</span>
        <span class="n">Deadline</span> <span class="p">=</span> <span class="m">99999</span>
    <span class="p">};</span>

    <span class="n">db</span><span class="p">.</span><span class="n">PaymentMethod</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">pm</span><span class="p">);</span>
    <span class="n">db</span><span class="p">.</span><span class="n">SaveChanges</span><span class="p">();</span>

    <span class="c1">// 4.6</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t4.6:&quot;</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">qPopularProducts</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">PopularProducts</span><span class="p">(</span><span class="m">5</span><span class="p">);</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">p</span> <span class="k">in</span> <span class="n">qPopularProducts</span><span class="p">)</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;\t\tName={0}\tStock={1}\tPrice={2}&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Stock</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Price</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</details>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <!--
  Copyright (c) 2016-2021 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->



<!-- Footer -->
<footer class="md-footer">

  <!-- Link to previous and/or next page -->
  
    <nav
      class="md-footer__inner md-grid"
      aria-label="Footer"
    >

      <!-- Link to previous page -->
      
        <a
          href="../mssql/"
          class="md-footer__link md-footer__link--prev"
          rel="prev"
        >
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Microsoft SQL Server programming
            </div>
          </div>
        </a>
      

      <!-- Link to next page -->
      
        <a
          href="../mongodb/"
          class="md-footer__link md-footer__link--next"
          rel="next"
        >
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              MongoDB
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">

      <!-- Copyright and theme information -->
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; BME VIK AUT
          </div>
        
      </div>

      <!-- Social links -->
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.top", "search.suggest"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.409db549.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.756773cc.min.js"></script>
      
    
  </body>
</html>